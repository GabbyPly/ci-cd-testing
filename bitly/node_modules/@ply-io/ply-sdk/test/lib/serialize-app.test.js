const serializeApp = require('../../src/lib/serialize-app');
const MockAppBuilder = require('../utils/mock_app_builder');
const MockContextMappingBuilder = require('../utils/mock_context_mapping_builder');

describe('testing middleware wrapper', () => {
	const contextMapping = new MockContextMappingBuilder().build();
	const app = new MockAppBuilder().addContextMapping(contextMapping).build();
	test('url regex after serializeApp is valid', () => {
		const demoURL = 'https://ply.some-context-domain.com/124312312213?hello=there';
		const appDefinition = serializeApp(app);
		expect(demoURL.match(JSON.parse(appDefinition).contextsMapping[0].url_regex)).toBeDefined();
		const regexStr = app.contextsMapping[0].url_regex.toString();
		expect(JSON.parse(appDefinition).contextsMapping[0].url_regex).toBe(regexStr.substring(1, regexStr.length - 1));
	});
});
